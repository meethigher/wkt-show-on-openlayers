import{q as t}from"./6846a6-D2m7jDoH.js";let i=class{constructor(t=9){this.t=Math.max(4,t),this.i=Math.max(2,Math.ceil(.4*this.t)),this.clear()}all(){return this.h(this.data,[])}search(t){let i=this.data;const s=[];if(!M(t,i))return s;const r=this.toBBox,n=[];for(;i;){for(let h=0;h<i.children.length;h++){const e=i.children[h],o=i.leaf?r(e):e;M(t,o)&&(i.leaf?s.push(e):a(t,o)?this.h(e,s):n.push(e))}i=n.pop()}return s}collides(t){let i=this.data;if(!M(t,i))return!1;const s=[];for(;i;){for(let r=0;r<i.children.length;r++){const n=i.children[r],h=i.leaf?this.toBBox(n):n;if(M(t,h)){if(i.leaf||a(t,h))return!0;s.push(n)}}i=s.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this.i){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let i=this.o(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this.u(this.data,i);else{if(this.data.height<i.height){const t=this.data;this.data=i,i=t}this.l(i,this.data.height-i.height-1,!0)}else this.data=i;return this}insert(t){return t&&this.l(t,this.data.height-1),this}clear(){return this.data=_([]),this}remove(t,i){if(!t)return this;let r=this.data;const n=this.toBBox(t),h=[],e=[];let o,u,c;for(;r||h.length;){if(r||(r=h.pop(),u=h[h.length-1],o=e.pop(),c=!0),r.leaf){const n=s(t,r.children,i);if(-1!==n)return r.children.splice(n,1),h.push(r),this.M(h),this}c||r.leaf||!a(r,n)?u?(o++,r=u.children[o],c=!1):r=null:(h.push(r),e.push(o),o=0,u=r,r=r.children[0])}return this}toBBox(t){return t}compareMinX(t,i){return t.minX-i.minX}compareMinY(t,i){return t.minY-i.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}h(t,i){const s=[];for(;t;)t.leaf?i.push(...t.children):s.push(...t.children),t=s.pop();return i}o(t,i,s,n){const h=s-i+1;let e,o=this.t;if(h<=o)return e=_(t.slice(i,s+1)),r(e,this.toBBox),e;n||(n=Math.ceil(Math.log(h)/Math.log(o)),o=Math.ceil(h/Math.pow(o,n-1))),e=_([]),e.leaf=!1,e.height=n;const u=Math.ceil(h/o),c=u*Math.ceil(Math.sqrt(o));m(t,i,s,c,this.compareMinX);for(let r=i;r<=s;r+=c){const i=Math.min(r+c-1,s);m(t,r,i,u,this.compareMinY);for(let s=r;s<=i;s+=u){const r=Math.min(s+u-1,i);e.children.push(this.o(t,s,r,n-1))}}return r(e,this.toBBox),e}_(t,i,s,r){for(;r.push(i),!i.leaf&&r.length-1!==s;){let s,r=1/0,n=1/0;for(let h=0;h<i.children.length;h++){const e=i.children[h],o=u(e),c=f(t,e)-o;c<n?(n=c,r=o<r?o:r,s=e):c===n&&o<r&&(r=o,s=e)}i=s||i.children[0]}return i}l(t,i,s){const r=s?t:this.toBBox(t),n=[],e=this._(r,this.data,i,n);for(e.children.push(t),h(e,r);i>=0&&n[i].children.length>this.t;)this.m(n,i),i--;this.p(r,n,i)}m(t,i){const s=t[i],n=s.children.length,h=this.i;this.S(s,h,n);const e=this.B(s,h,n),o=_(s.children.splice(e,s.children.length-e));o.height=s.height,o.leaf=s.leaf,r(s,this.toBBox),r(o,this.toBBox),i?t[i-1].children.push(o):this.u(s,o)}u(t,i){this.data=_([t,i]),this.data.height=t.height+1,this.data.leaf=!1,r(this.data,this.toBBox)}B(t,i,s){let r,h=1/0,e=1/0;for(let o=i;o<=s-i;o++){const i=n(t,0,o,this.toBBox),c=n(t,o,s,this.toBBox),f=l(i,c),a=u(i)+u(c);f<h?(h=f,r=o,e=a<e?a:e):f===h&&a<e&&(e=a,r=o)}return r||s-i}S(t,i,s){const r=t.leaf?this.compareMinX:e,n=t.leaf?this.compareMinY:o;this.X(t,i,s,r)<this.X(t,i,s,n)&&t.children.sort(r)}X(t,i,s,r){t.children.sort(r);const e=this.toBBox,o=n(t,0,i,e),u=n(t,s-i,s,e);let f=c(o)+c(u);for(let n=i;n<s-i;n++){const i=t.children[n];h(o,t.leaf?e(i):i),f+=c(o)}for(let n=s-i-1;n>=i;n--){const i=t.children[n];h(u,t.leaf?e(i):i),f+=c(u)}return f}p(t,i,s){for(let r=s;r>=0;r--)h(i[r],t)}M(t){for(let i,s=t.length-1;s>=0;s--)0===t[s].children.length?s>0?(i=t[s-1].children,i.splice(i.indexOf(t[s]),1)):this.clear():r(t[s],this.toBBox)}};function s(t,i,s){if(!s)return i.indexOf(t);for(let r=0;r<i.length;r++)if(s(t,i[r]))return r;return-1}function r(t,i){n(t,0,t.children.length,i,t)}function n(t,i,s,r,n){n||(n=_(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let e=i;e<s;e++){const i=t.children[e];h(n,t.leaf?r(i):i)}return n}function h(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function e(t,i){return t.minX-i.minX}function o(t,i){return t.minY-i.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function c(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,i){return(Math.max(i.maxX,t.maxX)-Math.min(i.minX,t.minX))*(Math.max(i.maxY,t.maxY)-Math.min(i.minY,t.minY))}function l(t,i){const s=Math.max(t.minX,i.minX),r=Math.max(t.minY,i.minY),n=Math.min(t.maxX,i.maxX),h=Math.min(t.maxY,i.maxY);return Math.max(0,n-s)*Math.max(0,h-r)}function a(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function M(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function _(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(i,s,r,n,h){const e=[s,r];for(;e.length;){if((r=e.pop())-(s=e.pop())<=n)continue;const o=s+Math.ceil((r-s)/n/2)*n;t(i,o,s,r,h),e.push(s,o,o,r)}}export{i as R};
